<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>frida jsè„šæœ¬ä½¿ç”¨æ–¹æ³• | æ¬¢è¿çº±å¸ƒä»¬çš„åˆ°æ¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="å‰å‡ å¤©å¬äº†ï¼ˆæ²¡æœ‰ï¼Œæœ‰äº‹å‡ºå»äº†ï¼‰ğŸ¶v0idçš„fridaåœ¨çº¿æ•™å­¦ï¼Œè‡ªå·±ä¹Ÿæ¥æ€»ç»“ä¸€ä¸‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³• â€‹">
<meta property="og:type" content="article">
<meta property="og:title" content="frida jsè„šæœ¬ä½¿ç”¨æ–¹æ³•">
<meta property="og:url" content="http://example.com/2020/10/18/frida-js%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/index.html">
<meta property="og:site_name" content="æ¬¢è¿çº±å¸ƒä»¬çš„åˆ°æ¥">
<meta property="og:description" content="å‰å‡ å¤©å¬äº†ï¼ˆæ²¡æœ‰ï¼Œæœ‰äº‹å‡ºå»äº†ï¼‰ğŸ¶v0idçš„fridaåœ¨çº¿æ•™å­¦ï¼Œè‡ªå·±ä¹Ÿæ¥æ€»ç»“ä¸€ä¸‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³• â€‹">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-10-18T08:14:56.000Z">
<meta property="article:modified_time" content="2020-11-03T11:59:28.757Z">
<meta property="article:author" content="Papaya">
<meta property="article:tag" content="re">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="æ¬¢è¿çº±å¸ƒä»¬çš„åˆ°æ¥" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/pig.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/plugin/bganimation/bg.css">

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" rel="stylesheet" type="text/css">
<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://i.loli.net/2020/09/25/QDZN6PSqghdjAUR.jpg">
    <h2 class="author">Papaya</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>23</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>0</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>4</strong><br>æ ‡ç­¾</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-frida-jsè„šæœ¬ä½¿ç”¨æ–¹æ³•" class="wow slideInRight article article-type-post"
  itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/18/frida-js%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" class="article-date">
  <time class="post-time" datetime="2020-10-18T08:14:56.000Z" itemprop="datePublished">
    <span class="post-month">10æœˆ</span><br/>
    <span class="post-day">18</span>
  </time>
</a>

  </div>
  <div class="article-inner">
    
    
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      frida jsè„šæœ¬ä½¿ç”¨æ–¹æ³•
    </h1>
  

      <div>
        
        
        

        
      </div>
    </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      <p>å‰å‡ å¤©å¬äº†ï¼ˆæ²¡æœ‰ï¼Œæœ‰äº‹å‡ºå»äº†ï¼‰ğŸ¶v0idçš„fridaåœ¨çº¿æ•™å­¦ï¼Œè‡ªå·±ä¹Ÿæ¥æ€»ç»“ä¸€ä¸‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•</p>
<p>â€‹    <a id="more"></a></p>
<p>é¦–å…ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯jsè„šæœ¬ï¼Œépythonæˆ–è€…å…¶ä»–è„šæœ¬</p>
<p>å®‰è£…fridaä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install frida-tools</span><br></pre></td></tr></table></figure>

<p>è¯¥ä½¿ç”¨ç®¡ç†å‘˜/rootæƒé™å°±æ˜¯ç”¨</p>
<p>è‡³äºå®‰è£…å¤šä¹…æˆ‘å°±ä¸çŸ¥é“äº†ï¼Œåæ­£æˆ‘åœ¨windowsä¸‹æ²¡æŒ‚æ¢¯å­å®‰è£…äº†è¿‘ä¸€ä¸ªå°æ—¶</p>
<p>ä½¿ç”¨æŸä¸ªè„šæœ¬ç”¨ä¸€ä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frida -n [æ­£åœ¨è¿è¡Œæ–‡ä»¶å] -l [jsè„šæœ¬è·¯å¾„]</span><br><span class="line">æ¯”æˆ‘è¦ç”¨å½“å‰ç›®å½•çš„a.jsè„šæœ¬ å»hookä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„æ–‡ä»¶b</span><br><span class="line">frida -n b -l &quot;./a.js&quot;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨jsè„šæœ¬ä¸»è¦çš„éº»çƒ¦è¿˜æ˜¯ä¸çŸ¥é“æœ‰å“ªäº›å‡½æ•°ï¼Œå¯ä»¥æ€ä¹ˆä½¿ç”¨ï¼Œæœ‰äº›æ—¶å€™å°±åœ¨<a target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/">ä½¿ç”¨æ–‡æ¡£</a>é‡Œæœç´¢å…³é”®è¯ï¼Œæ¯”å¦‚ â€˜allocâ€™</p>
<p>fridaé‡Œé¢æœ€å¸¸ç”¨çš„å˜é‡æ˜¯<a target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/#nativepointer">NativePointer</a> è¯¥å˜é‡çš„å¾ˆå¤šç§è¿ç®—éƒ½æœ‰å†…ç½®å‡½æ•°å®ç°ï¼Œæ¯”å¦‚åŠ æ³•ä½¿ç”¨add()è€Œä¸èƒ½ç›´æ¥ä½¿ç”¨ â€˜+â€™</p>
<p>æŠŠä¸€ä¸ªæ•°å€¼ç”³è¯·ä¸ºä¸€ä¸ªNativePointerå˜é‡ä½¿ç”¨ ptr() æ¯”å¦‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addr = ptr(<span class="number">0x12345678</span>)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥çš„ä½¿ç”¨æ–¹æ³•åœ¨fridaçš„åº”ç”¨é‡Œé¢ä»‹ç»ï¼ˆå…ˆç»™ä¸€ä¸‹æˆ‘ç”¨åˆ°çš„æ–‡ä»¶.  <a target="_blank" rel="noopener" href="https://github.com/papayawd/files_used_in_MyBlog/raw/master/b">ELFæ–‡ä»¶</a>     <a target="_blank" rel="noopener" href="https://github.com/papayawd/files_used_in_MyBlog/blob/master/b.c">æºä»£ç </a> ï¼‰</p>
<h2 id="1-dumpæ•°å€¼"><a href="#1-dumpæ•°å€¼" class="headerlink" title="1.dumpæ•°å€¼"></a>1.dumpæ•°å€¼</h2><p><a target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/#hexdump">Hexdumpä½¿ç”¨</a> è¿™é‡Œå°±ä¸æ”¾ä»£ç äº† æŒºç®€å•çš„</p>
<h2 id="2-è·å–å¹¶ä¸”ä¿®æ”¹è¢«hookå‡½æ•°çš„å‚æ•°"><a href="#2-è·å–å¹¶ä¸”ä¿®æ”¹è¢«hookå‡½æ•°çš„å‚æ•°" class="headerlink" title="2.è·å–å¹¶ä¸”ä¿®æ”¹è¢«hookå‡½æ•°çš„å‚æ•°"></a>2.è·å–å¹¶ä¸”ä¿®æ”¹è¢«hookå‡½æ•°çš„å‚æ•°</h2><p>ï¼ˆç›¸å½“äºåŠ¨æ€è°ƒè¯•è·å–æŸä¸ªå€¼ï¼Œæœ‰äº›æ—¶å€™é…åˆhexdumpï¼Œå¯ä»¥å§å…³é”®æ•°æ®ç›´æ¥å¼„å‡ºæ¥ï¼‰</p>
<p>fridaä¸€èˆ¬ä½¿ç”¨<a target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/#interceptor">Interceptor</a>æ¨¡å—é‡Œé¢attachçš„è¿›è¡Œhook ç»“æ„å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach( ptr(hook_addr),</span><br><span class="line">&#123;</span><br><span class="line">    onEnter: function(args) // è¿™é‡Œçš„angrå°±æ˜¯å‚æ•°æ•°ç»„ å³args[0]æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°</span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//				do something before function begin</span></span><br><span class="line">    &#125;, <span class="comment">// æ³¨æ„ä»–ä»¬ä¹‹é—´ç”¨é€—å·åˆ†éš”å¼€</span></span><br><span class="line">  	onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>)// å‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line"><span class="function">  	</span>&#123;</span><br><span class="line"><span class="comment">//      	do something after function end</span></span><br><span class="line"><span class="comment">//				åœ¨è¿™é‡Œé¢å¯ä»¥æ›¿æ¢è¿”å›å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>hook WindowsAPI å¯ä»¥ä½¿ç”¨Moduleæ¨¡å—çš„getExportByName  è¿”å›å€¼æ˜¯ä¸€ä¸ªNativePointer ä¸éœ€è¦ç”¨ptrè½¬ä¸€ä¸‹ï¼Œæ¯”å¦‚æ‰¾ä¸€ä¸‹MessaageBoxAä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">Function</span> = Module.getExportByName(<span class="string">&#x27;user32,dll&#x27;</span>,<span class="string">&#x27;MessaageBoxA&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ä¿®æ”¹ç»™å‡ºæ–‡ä»¶é‡Œçš„encodeå‡½æ•°çš„å‚æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(ptr(<span class="number">0x4006E7</span>),</span><br><span class="line">    &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">          	<span class="built_in">console</span>.log(<span class="string">&#x27;angr[0] -&gt; &#x27;</span> + args[<span class="number">0</span>]) <span class="comment">// è¦è¾“å‡ºæŸä¸ªä¿¡æ¯åˆ°frida</span></span><br><span class="line">            <span class="keyword">var</span> str = Memory.allocUtf8String(<span class="string">&quot;654322&quot;</span>);</span><br><span class="line">           	args[<span class="number">0</span>] = str; <span class="comment">// å¯ä»¥ç›´æ¥ä¿®æ”¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ä½¿ç”¨Memoryçš„allocUtf8Stringæ¨¡å— ç”³è¯·ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›ç±»å‹ä¹Ÿæ˜¯NativePointer</p>
<p>å¦‚æœâ€654322â€æ˜¯æ­£ç¡®çš„è¾“å…¥ é‚£ä¹ˆç¨‹åºæœ€ç»ˆå°±ä¼šè¾“å‡ºok</p>
<h2 id="3-è°ƒç”¨æŸä¸ªå­˜åœ¨çš„å‡½æ•°"><a href="#3-è°ƒç”¨æŸä¸ªå­˜åœ¨çš„å‡½æ•°" class="headerlink" title="3.è°ƒç”¨æŸä¸ªå­˜åœ¨çš„å‡½æ•°"></a>3.è°ƒç”¨æŸä¸ªå­˜åœ¨çš„å‡½æ•°</h2><p>ï¼ˆå¯ç”¨æ¥çˆ†ç ´æŸä¸ªåŠ å¯†/è§£å¯†ç®—æ³•ï¼‰</p>
<p>è¿™é‡Œç›´æ¥ä¸Šè„šæœ¬</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> number = <span class="number">100000</span>;</span><br><span class="line">Interceptor.attach(ptr(<span class="number">0x4006E7</span>),</span><br><span class="line">    &#123;</span><br><span class="line">        onLeave: <span class="function"><span class="keyword">function</span> (<span class="params">retval</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;hook begin&#x27;</span>);</span><br><span class="line">            <span class="keyword">for</span>(;number &lt;= <span class="number">999999</span>;number++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(number % <span class="number">100000</span> == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(number);</span><br><span class="line">                &#125;    </span><br><span class="line">                <span class="keyword">var</span> <span class="built_in">Function</span> = <span class="keyword">new</span> NativeFunction(ptr(<span class="number">0x4006E7</span>),<span class="string">&#x27;bool&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">                <span class="keyword">var</span> str = Memory.allocUtf8String(number.toString());</span><br><span class="line">                <span class="keyword">var</span> k = <span class="built_in">Function</span>(str);</span><br><span class="line">                <span class="keyword">if</span> (k == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;key : &#x27;</span> + number);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæœ‰æåˆ°è¾“å…¥æ˜¯å…­ä½æ•°ï¼Œç›´æ¥çˆ†ç ´åœ¨æ—¶é—´æ–¹é¢æ˜¯æœ‰å¯è¡Œåº¦çš„</p>
<p>æ—¢ç„¶æ˜¯çˆ†ç ´ å°±éœ€è¦åå¤è°ƒç”¨æŸä¸ªå‡½æ•° è¿™é‡Œä½¿ç”¨ NativeFunction ä½¿ç”¨è§„åˆ™å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">Function</span> = <span class="keyword">new</span> NativeFunction(ptr(func_addr),<span class="string">&#x27;ret_type&#x27;</span>,[<span class="string">&#x27;args_array&#x27;</span>])</span><br><span class="line"><span class="comment">//å‚æ•°ä¾æ¬¡æ˜¯ è°ƒç”¨å‡½æ•°åœ°å€ï¼Œè¿”å›ç±»å‹ï¼Œå‚æ•°æ•°ç»„</span></span><br><span class="line"><span class="comment">//ç»è¿‡è¯•éªŒ NativeFunctionç”³è¯·çš„å‡½æ•°ä¸èƒ½è¢«hook å…·ä½“åŸå› æœªçŸ¥ï¼ˆä¸Šè¿‡å½“</span></span><br></pre></td></tr></table></figure>

<h2 id="4-Android-Hookï¼ˆMuMuè™šæ‹Ÿæœºï¼‰macç‰©ç†æœº"><a href="#4-Android-Hookï¼ˆMuMuè™šæ‹Ÿæœºï¼‰macç‰©ç†æœº" class="headerlink" title="4. Android Hookï¼ˆMuMuè™šæ‹Ÿæœºï¼‰macç‰©ç†æœº"></a>4. Android Hookï¼ˆMuMuè™šæ‹Ÿæœºï¼‰macç‰©ç†æœº</h2><p>å­¦ä¹ å€Ÿé‰´åšå®¢ï¼š<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7be526b77bd2">https://www.jianshu.com/p/7be526b77bd2</a>     <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d4a44f803f33">https://www.jianshu.com/p/d4a44f803f33</a></p>
<h3 id="1-å®‰è£…å·¥å…·"><a href="#1-å®‰è£…å·¥å…·" class="headerlink" title="1.å®‰è£…å·¥å…·"></a>1.å®‰è£…å·¥å…·</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install android-platform-tools <span class="comment"># å®‰è£…adb</span></span><br></pre></td></tr></table></figure>

<p>â€‹        æ‰“å¼€è™šæ‹Ÿæœºä¹‹å</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell getprop ro.product.cpu.abi <span class="comment"># è·å–è™šæ‹Ÿæœºå¤„ç†å™¨å‹å·</span></span><br><span class="line">frida --version <span class="comment"># è·å–fridaçš„ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>

<p>â€‹        ç„¶åå»<a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases">githubå®˜ç½‘</a>æ‰¾å¯¹åº”çš„ç‰ˆæœ¬ï¼Œå¯¹åº”å®‰å“å¤„ç†å™¨å‹å·çš„frida-server</p>
<h3 id="2-è¿è¡Œfrida-server"><a href="#2-è¿è¡Œfrida-server" class="headerlink" title="2.è¿è¡Œfrida-server"></a>2.è¿è¡Œfrida-server</h3><p>â€‹        è§£å‹ä»¥åä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶åä¸ºfrida-server ç„¶åé€šè¿‡adbæ¨é€ç»™è™šæ‹Ÿæœº</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server /data/local/tmp/ <span class="comment">#æ¨é€serverç»™è™šæ‹Ÿæœºçš„è¿™ä¸ªè·¯å¾„ä¸‹</span></span><br><span class="line">adb shell <span class="comment"># è¿›å…¥è™šæ‹Ÿæœºçš„shell</span></span><br><span class="line">cd /data/local/tmp/ <span class="comment">#è¿›å…¥æ¨é€ç›®å½•</span></span><br><span class="line">chmod <span class="number">777</span> frida-server <span class="comment">#ç»™æ‰§è¡Œæƒé™</span></span><br><span class="line">./frida-server <span class="comment">#æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<p>â€‹        ç„¶åè¿™ä¸ªå‘½ä»¤è¡Œçª—å£å°±ä¸€ç›´æŒ‚ç€å°±è¡Œäº†</p>
<h3 id="3-å¯åŠ¨ç¨‹åºå¹¶ä¸”hook"><a href="#3-å¯åŠ¨ç¨‹åºå¹¶ä¸”hook" class="headerlink" title="3.å¯åŠ¨ç¨‹åºå¹¶ä¸”hook"></a>3.å¯åŠ¨ç¨‹åºå¹¶ä¸”hook</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l [jsè„šæœ¬è·¯å¾„] --no-pause -f [ç¨‹åºåŒ…åç§°]</span><br><span class="line">adb shell pm list package <span class="comment">#æ‰€æœ‰ç¨‹åºåŒ…çš„åç§°ï¼Œå¯ä»¥è¿‡æ»¤ä¸€ä¸‹</span></span><br></pre></td></tr></table></figure>

<h3 id="4-è„šæœ¬ç¼–å†™"><a href="#4-è„šæœ¬ç¼–å†™" class="headerlink" title="4.è„šæœ¬ç¼–å†™"></a>4.è„šæœ¬ç¼–å†™</h3><p>â€‹    æ‰€æœ‰çš„ä»£ç éƒ½è¦å°è£…åœ¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>â€‹    å¦‚æœè¦è·å–ä¸€ä¸ªJavaScript wrapperï¼ˆå°è£…ï¼‰ä½¿ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> className = Java.use([className])</span><br></pre></td></tr></table></figure>

<p>â€‹    ç„¶åç»§ç»­ï¼Œå¦‚æœè¦hookè¿™ä¸ªå°è£…é‡Œé¢çš„æŸä¸ªå‡½æ•° ä½¿ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">className.[funcName].implementation = <span class="function"><span class="keyword">function</span>(<span class="params">arg1, ... </span>)</span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//è¿™é‡Œçš„å‚æ•°æ ¹æ®åŸå‡½æ•°å¡«å……</span></span><br></pre></td></tr></table></figure>

<p>â€‹    å¦‚æœæ”¹å°è£…æœ‰é‡åå‡½æ•°ï¼ˆé‡è½½ï¼‰ è¿™æ ·ä½¿ç”¨</p>
<p>Androidä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected <span class="keyword">void</span> onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.mBtnTest).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public <span class="keyword">void</span> onClick(final View v) &#123;</span><br><span class="line">                helloAndroid();</span><br><span class="line">                test1();</span><br><span class="line">                test2(<span class="number">123</span>);</span><br><span class="line">                test3(<span class="string">&quot;str&quot;</span>);</span><br><span class="line">                test4(<span class="string">&quot;str&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private <span class="keyword">void</span> helloAndroid() &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;helloAndroid()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> test() &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test1()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> test(int i) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test2(int) &quot;</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> test(<span class="built_in">String</span> s) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test3(String) &quot;</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> test(<span class="built_in">String</span> s, boolean b) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test4(String, boolean) &quot;</span> + s + <span class="string">&quot;, &quot;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>JS Hookä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> MainActivity = Java.use(<span class="string">&quot;com.github.fridademo.MainActivity&quot;</span>);</span><br><span class="line">    MainActivity.helloAndroid.implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;helloAndroid()&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.private_func();</span><br><span class="line">    &#125;;</span><br><span class="line">    MainActivity.test.overload().implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;test1()&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.private_func();</span><br><span class="line">    &#125;;</span><br><span class="line">    MainActivity.test.overload(<span class="string">&quot;int&quot;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;test2(int): &quot;</span> + i);</span><br><span class="line">        <span class="built_in">this</span>.private_func(i);</span><br><span class="line">    &#125;;</span><br><span class="line">    MainActivity.test.overload(<span class="string">&quot;java.lang.String&quot;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;test3(String): &quot;</span> + <span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">this</span>.private_func(<span class="built_in">arguments</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;;</span><br><span class="line">    MainActivity.test.overload(<span class="string">&quot;java.lang.String&quot;</span>, <span class="string">&quot;boolean&quot;</span>).implementation = <span class="function"><span class="keyword">function</span> (<span class="params">s, b</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;test4(String,boolean): &quot;</span> + s + <span class="string">&quot;, &quot;</span> + b);</span><br><span class="line">        <span class="built_in">this</span>.private_func(s, b);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆä¸Šä¸¤ä¸ªä»£ç ç‰‡æ®µå‡æ‘˜æŠ„è‡ªå€Ÿæ®µé¦–æåˆ°çš„ å€Ÿé‰´å­¦ä¹ çš„åšå®¢ ï¼‰</p>
<p>â€‹        å¯ä»¥çœ‹å‡ºè§„å¾‹ï¼Œä½¿ç”¨overload(typename, â€¦ )å¯ä»¥å®šä½åˆ°æƒ³è¦hookçš„å‡½æ•°</p>
<p>â€‹    å®æˆ˜ä¾‹å­è§è¯¥åšå®¢å†™çš„ByteCTF-DaShen-Decode-AES</p>
<p>â€‹        </p>
<p>â€‹        </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/18/frida-js%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" data-id="cki1b8w6j000yv0ca8ckp3mtb" class="article-share-link">åˆ†äº«</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/re/" rel="tag">re</a></li></ul>

    </footer>
  </div>
  
  
<nav id="article-nav">
  
    <a href="/2020/10/21/BUU-FlareOn2-sender/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          BUU-[FlareOn2]sender
        
      </div>
    </a>
  
  
    <a href="/2020/10/03/BUU-Tricky-Part2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">BUU-Tricky-Part2</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">æ¬¢è¿çº±å¸ƒä»¬çš„åˆ°æ¥</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>ä¸»é¡µ</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>å½’æ¡£</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>åˆ†ç±»</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>æ ‡ç­¾</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://i.loli.net/2020/09/25/QDZN6PSqghdjAUR.jpg">
    <h2 class="author">Papaya</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>23</strong><br>æ–‡ç« </div></a>
      <a href="/categories"><div><strong>0</strong><br>åˆ†ç±»</div></a>
      <a href="/tags"><div><strong>4</strong><br>æ ‡ç­¾</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="" target="_blank" title="">
          
        </a>
      
    </div>

    <div class="friend-link">
      <h2>å‹æƒ…é“¾æ¥</h2>
      
        <a class="hvr-bounce-in" href="https://zhiaowei.github.io/" target="_blank" title="è¶…å¼ºé­å§å§">
          è¶…å¼ºé­å§å§
        </a>
      
        <a class="hvr-bounce-in" href="https://l0x1c.github.io/" target="_blank" title="å°æºæºå¸ˆå‚…">
          å°æºæºå¸ˆå‚…
        </a>
      
        <a class="hvr-bounce-in" href="https://www.izaiahsun.com/" target="_blank" title="å­™ç¥yyds">
          å­™ç¥yyds
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2019 - 2020 Papaya<br>
      ç”±<a href="http://hexo.io/" target="_blank">Hexo</a>å¼ºåŠ›é©±åŠ¨ | 
      ä¸»é¢˜-<a target="_blank" rel="noopener" href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  
<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">

  
<script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>




  
<link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">

  
<script src="/plugin/galmenu/GalMenu.js"></script>

  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">é¦–é¡µ</a>
          
            <a href="/tags" title="" class="menuItem">æ ‡ç­¾</a>
          
            <a href="/categories" title="" class="menuItem">åˆ†ç±»</a>
          
            <a href="/archives" title="" class="menuItem">å½’æ¡£</a>
          
            <a href="/xxxxxxxxx" title="" class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title="" class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>è‹Ÿåˆ©</span></li> 
    <li><span>å›½å®¶</span></li> 
    <li><span>ç”Ÿæ­»ä»¥</span></li> 
    <li><span>å²‚èƒ½</span></li> 
    <li><span>ç¥¸ç¦</span></li> 
    <li><span>è¶‹é¿ä¹‹</span></li> 
  </ul>
</section>

<script src="/js/script.js"></script>




  </div>
</body>
</html>